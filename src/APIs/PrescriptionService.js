const STATIC_PRESCRIPTION_LIST = [
  {
    id: 1,
    category: "normal",
    classType: "special",
    queue: "fast",
    createdDate: "2020-06-15T14:39:39.254+00:00",
    dueDate: "2020-06-15T14:39:39.254+00:00",
    owner: "",
    status: "Backlog",
    medicates: [{
      id: 5,
      name: "Vitamina C",
      quantity: 15,
      presentation: "Pastillas",
      freqType: "Crónico",
      classType: "Regular",
      rangeType: "No Pediátrico",
      checked: false
    }],
    comments: null
  },
  {
    id: 2,
    category: "normal",
    classType: "normal",
    queue: "normal",
    createdDate: "2020-06-09T16:13:33.366+00:00",
    dueDate: "2020-06-09T16:13:33.366+00:00",
    owner: "",
    status: "Backlog",
    medicates: [
      {
        id: 4,
        name: "Ibuprofeno",
        quantity: 10,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 3,
        name: "Salbutamol",
        quantity: 2,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 1,
        name: "Ibuprofeno",
        quantity: 30,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 3,
        name: "Salbutamol",
        quantity: 2,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      }
    ],
    comments: null
  },
  {
    id: 3,
    category: "urgent",
    classType: "special",
    queue: "fast",
    createdDate: "2020-06-09T16:13:33.366+00:00",
    dueDate: "2020-06-09T16:13:33.366+00:00",
    owner: "",
    status: "Backlog",
    medicates: [
      {
        id: 4,
        name: "Ibuprofeno",
        quantity: 10,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      }
    ],
    comments: null
  },
  {
    id: 4,
    category: "normal",
    classType: "normal",
    queue: "normal",
    createdDate: "2020-06-09T16:13:33.366+00:00",
    dueDate: "2020-06-09T16:13:33.366+00:00",
    owner: "",
    status: "Backlog",
    medicates: [
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 1,
        name: "Ibuprofeno",
        quantity: 30,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 1,
        name: "Ibuprofeno",
        quantity: 30,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      }
    ],
    comments: null
  },
  {
    id: 5,
    category: "normal",
    classType: "normal",
    queue: "fast",
    createdDate: "2020-06-09T16:13:33.366+00:00",
    dueDate: "2020-06-09T16:13:33.366+00:00",
    owner: "",
    status: "Approved",
    medicates: [
      {
        id: 4,
        name: "Ibuprofeno",
        quantity: 10,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 4,
        name: "Ibuprofeno",
        quantity: 10,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      }
    ],
    comments: null
  },
  {
    id: 6,
    category: "normal",
    classType: "normal",
    queue: "normal",
    createdDate: "2020-06-09T16:13:33.366+00:00",
    dueDate: "2020-06-09T16:13:33.366+00:00",
    owner: "",
    status: "Backlog",
    medicates: [
      {
        id: 3,
        name: "Salbutamol",
        quantity: 2,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 1,
        name: "Ibuprofeno",
        quantity: 30,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 1,
        name: "Ibuprofeno",
        quantity: 30,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      }
    ],
    comments: null
  },
  {
    id: 7,
    category: "normal",
    classType: "normal",
    queue: "fast",
    createdDate: "2020-06-09T16:13:33.366+00:00",
    dueDate: "2020-06-09T16:13:33.366+00:00",
    owner: "",
    status: "Backlog",
    medicates: [
      {
        id: 4,
        name: "Ibuprofeno",
        quantity: 10,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      }
    ],
    comments: null
  },
  {
    id: 8,
    category: "normal",
    classType: "normal",
    queue: "normal",
    createdDate: "2020-06-09T16:13:33.366+00:00",
    dueDate: "2020-06-09T16:13:33.366+00:00",
    owner: "",
    status: "Backlog",
    medicates: [
      {
        id: 3,
        name: "Salbutamol",
        quantity: 2,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 2,
        name: "Salbutamol",
        quantity: 1,
        presentation: "Bombita",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      },
      {
        id: 1,
        name: "Ibuprofeno",
        quantity: 30,
        presentation: "Pastillas",
        freqType: "Crónico",
        classType: "Regular",
        rangeType: "No Pediátrico",
        checked: false
      }
    ],
    comments: null
  }
];

class PrescriptionService {
  getAllPrescriptionList() {
    return STATIC_PRESCRIPTION_LIST;
  }

  getAllPrescriptionListByAction(action, line) {
    let result

    switch (action) {
      case 'special':
        result = this.getPrescriptionListByLine('fast').map(prescription => {
          if (prescription.status === 'Backlog' && prescription.owner.length === 0 && prescription.classType === 'special') {
            return prescription;
          } else {
            return null;
          }
        }).filter(x => x);
        break;

      case 'waiting':
        result = this.getAllPrescriptionList().map(prescription => {
          if (prescription.owner.length === 0 && prescription.status === 'Waiting') {
            return prescription;
          } else {
            return null;
          }
        }).filter(x => x);
        break;

      case 'normal':
        result = this.getPrescriptionListByLine(line).map(prescription => {
          if (prescription.status === 'Backlog' && prescription.owner.length === 0 && prescription.classType !== 'special') {
            return prescription;
          } else {
            return null;
          }
        }).filter(x => x);
        break;

      case 'ventana':
        result = this.getAllPrescriptionList();
        break;

      case 'empaque':
        result = this.getAllPrescriptionList().map(prescription => {
          if (prescription.status === 'Approved' && prescription.owner.length === 0) {
            return prescription;
          } else {
            return null;
          }
        }).filter(x => x);
        break;

      case 'entrega':
        result = this.getAllPrescriptionList().map(prescription => {
          if (prescription.status === 'Deliverable' && prescription.owner.length === 0) {
            return prescription;
          } else {
            return null;
          }
        }).filter(x => x);
        break;

      case 'admin':
        result = this.getAllPrescriptionList();
        break;

      default:
        result = null
        break;
    }

    return result
  }

  getPrescriptionListById(id) {
    return {
      ...STATIC_PRESCRIPTION_LIST.find(prescription => prescription.id === parseInt(id))
    };
  }

  getPrescriptionListByUser(username) {
    return STATIC_PRESCRIPTION_LIST.map(prescription => {
      if (prescription.owner === username) {
        return prescription;
      } else {
        return null;
      }
    }).filter(x => x);
  }

  getPrescriptionListByLine(line) {
    return this.getPrescriptionListByClassType().map(prescription => {
      if (prescription.queue === line) {
        return prescription
      }

      return null
    }).filter(x => x)
  }

  getPrescriptionListByClassType() {
    let normal = []
    let urgent = []

    STATIC_PRESCRIPTION_LIST.map(prescription => {
      if (prescription.category === 'urgent') {
        urgent.push(prescription)
      } else {
        normal.push(prescription)
      }

      return null
    })

    return urgent.concat(normal);
  }

  // Change by amount
  getRecordsLogByStatus(status) {
    let records;

    if (status === "completed") {
      records = 13;
    } else {
      records = 47;
    }

    return records;
  }

  // Change for time taken by each prescription
  getTimeByLine(line) {
    let time;

    if (line === "fast") {
      time = "27m";
    } else {
      time = "1h 30m";
    }
    return time;
  }

  update(prescriptionUpdated) {
    let result = true
    prescriptionUpdated.id = parseInt(prescriptionUpdated.id)

    try {
      let prescription = STATIC_PRESCRIPTION_LIST.find(prescription => prescription.id === parseInt(prescriptionUpdated.id))
      const index = STATIC_PRESCRIPTION_LIST.indexOf(prescription)

      STATIC_PRESCRIPTION_LIST[index] = prescriptionUpdated
    } catch (e) {
      result = false
    }

    return result
  }

  updateCategory(id, category) {
    let result = true

    try {
      let prescription = STATIC_PRESCRIPTION_LIST.find(prescription => prescription.id === parseInt(id))
      prescription.category = atob(category)
    } catch (e) {
      result = false
    }

    return result
  }

  updateOwner(id, owner, action) {
    let result = true

    try {
      let prescription = STATIC_PRESCRIPTION_LIST.find(prescription => prescription.id === parseInt(id))
      
      if (this.setOwnerByAction(prescription.classType, prescription.status, atob(action))) {
        const index = STATIC_PRESCRIPTION_LIST.indexOf(prescription)
        let medicates = [...prescription.medicates]
        prescription.owner = atob(owner)

        prescription.medicates = medicates.map(medicate => {
          medicate.checked = false
          return medicate
        })

        STATIC_PRESCRIPTION_LIST[index] = prescription
      } else {
        result = false
      }
    } catch (e) {
      console.log(e)
      result = false
    }

    return result
  }

  setOwnerByAction(classType, status, action) {
    let result = false

    switch (action) {
      case 'normal':
        result = status === 'Backlog' && classType !== 'special';
        break;

      case 'special':
        result = status === 'Backlog' && classType === 'special';
        break;

      case 'waiting':
        result = status === 'Waiting';
        break;

      case 'empaque':
        result = status === 'Approved';
        break;

      case 'entrega':
        result = status === 'Deliverable';
        break;

      default:
        break;
    }

    return result
  }
}

export default new PrescriptionService();
